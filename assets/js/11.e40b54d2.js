(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{306:function(t,a,e){"use strict";e.r(a);var n=e(38),s=Object(n.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"caching"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#caching","aria-hidden":"true"}},[t._v("#")]),t._v(" Caching")]),t._v(" "),e("p",[t._v("Caching enables content to be sent to the client faster, improving the performance of the "),e("code",[t._v("web")]),t._v(" application while reducing the load on the server.")]),t._v(" "),e("h2",{attrs:{id:"page-level-cache-micro-caching"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#page-level-cache-micro-caching","aria-hidden":"true"}},[t._v("#")]),t._v(" Page-level cache (micro-caching)")]),t._v(" "),e("p",[t._v("As explained in "),e("a",{attrs:{href:"https://ssr.vuejs.org/guide/caching.html#page-level-caching",target:"_blank",rel:"noopener noreferrer"}},[t._v("Official Documentation"),e("OutboundLink")],1),t._v(", the proper use of "),e("a",{attrs:{href:"https://www.nginx.com/blog/benefits-of-microcaching-nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro-caching"),e("OutboundLink")],1),t._v(" can greatly improve the server's Requests per second("),e("code",[t._v("RPS")]),t._v(").")]),t._v(" "),e("p",[t._v("But not all pages are suitable for "),e("a",{attrs:{href:"https://www.nginx.com/blog/benefits-of-microcaching-nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro-caching"),e("OutboundLink")],1),t._v(" caching strategy, we can divide resources into three categories:")]),t._v(" "),e("ul",[e("li",[t._v("Static resources: such as "),e("code",[t._v("js")]),t._v(", "),e("code",[t._v("css")]),t._v(", "),e("code",[t._v("images")]),t._v(", etc.")]),t._v(" "),e("li",[t._v("Personalized content: Content customized for each user by the server application.")]),t._v(" "),e("li",[t._v("Non-personalized dynamic content：Any user accessing the resource will get the same content, but the content may change at any time, such as a blog post.")])]),t._v(" "),e("p",[t._v('Only "non-personalized dynamic resources" are suitable for the application '),e("a",{attrs:{href:"https://www.nginx.com/blog/benefits-of-microcaching-nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro-caching"),e("OutboundLink")],1),t._v(" caching strategy.")]),t._v(" "),e("p",[t._v("By default, "),e("code",[t._v("Vapper")]),t._v(" does not apply the "),e("a",{attrs:{href:"https://www.nginx.com/blog/benefits-of-microcaching-nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro-caching"),e("OutboundLink")],1),t._v(" caching policy to any page. You can enable "),e("a",{attrs:{href:"https://www.nginx.com/blog/benefits-of-microcaching-nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro-caching"),e("OutboundLink")],1),t._v(" by modifying the "),e("code",[t._v("pageCache")]),t._v(" option in the "),e("code",[t._v("vapper.config.js")]),t._v(" file:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// vapper.config.js")]),t._v("\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pageCache"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{attrs:{class:"token comment"}},[t._v("// Only /about will be applied micro-caching")]),t._v("\n    cacheable"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" req "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" req"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),e("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'/about'")]),t._v("\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"the-cacheable-function"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-cacheable-function","aria-hidden":"true"}},[t._v("#")]),t._v(" The "),e("code",[t._v("cacheable")]),t._v(" function")]),t._v(" "),e("p",[t._v("By default, "),e("code",[t._v("Vapper")]),t._v(" does not use the "),e("a",{attrs:{href:"https://www.nginx.com/blog/benefits-of-microcaching-nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro-caching"),e("OutboundLink")],1),t._v(" caching strategy for any page, which means that the default value for "),e("code",[t._v("pageCache.cacheable")]),t._v(" is:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// vapper.config.js")]),t._v("\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pageCache"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{attrs:{class:"token comment"}},[t._v("// Disable")]),t._v("\n    cacheable"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The "),e("code",[t._v("cacheable")]),t._v(" function accepts the request object("),e("code",[t._v("req")]),t._v(") as a parameter, and returns "),e("code",[t._v("true")]),t._v(" or "),e("code",[t._v("false")]),t._v(" to determine whether to cache the page. If "),e("code",[t._v("true")]),t._v(" is returned, it means that it needs to be cached. So you can write a caching strategy by customizing the "),e("code",[t._v("cacheable")]),t._v(" function:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// vapper.config.js")]),t._v("\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pageCache"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cacheable"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" req "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" req"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),e("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'/about'")]),t._v("\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"the-cacheoptions-option"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-cacheoptions-option","aria-hidden":"true"}},[t._v("#")]),t._v(" The "),e("code",[t._v("cacheOptions")]),t._v(" option")]),t._v(" "),e("p",[e("code",[t._v("Vapper")]),t._v(" internally uses "),e("a",{attrs:{href:"https://github.com/isaacs/node-lru-cache",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-lru-cache"),e("OutboundLink")],1),t._v(", the default options are:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// vapper.config.js")]),t._v("\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pageCache"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cacheOptions"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      max"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("100")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      maxAge"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("For all options, please see: "),e("a",{attrs:{href:"https://github.com/isaacs/node-lru-cache#options",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-lru-cache Options"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"the-cache-key"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-cache-key","aria-hidden":"true"}},[t._v("#")]),t._v(" The Cache key")]),t._v(" "),e("p",[t._v("By default, "),e("code",[t._v("Vapper")]),t._v(" takes the current URL as the cache "),e("code",[t._v("key")]),t._v(", but sometimes this does not suffice. You can implement the custom cache "),e("code",[t._v("key")]),t._v(" by customizing the "),e("code",[t._v("pageCache.getCacheKey")]),t._v(" function. which default is:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// vapper.config.js")]),t._v("\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pageCache"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{attrs:{class:"token function-variable function"}},[t._v("getCacheKey")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" req "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" req"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"component-level-cache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#component-level-cache","aria-hidden":"true"}},[t._v("#")]),t._v(" Component level cache")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://ssr.vuejs.org/#what-is-server-side-rendering-ssr",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-server-renderer"),e("OutboundLink")],1),t._v(" has a built-in "),e("a",{attrs:{href:"https://ssr.vuejs.org/guide/caching.html#component-level-caching",target:"_blank",rel:"noopener noreferrer"}},[t._v("component-level cache"),e("OutboundLink")],1),t._v(", you only need to provide the corresponding cache implementation.")]),t._v(" "),e("p",[t._v("You can specify the appropriate cache implementation by modifying the "),e("code",[t._v("rendererOptions")]),t._v(" option in the "),e("code",[t._v("vapper.config.js")]),t._v(" file:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// vapper.config.js")]),t._v("\n"),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{attrs:{class:"token constant"}},[t._v("LRU")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("require")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'lru-cache'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cache "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{attrs:{class:"token class-name"}},[t._v("LRU")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  max"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("10000")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  maxAge"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("60")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("60")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  rendererOptions"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cache\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Then use "),e("code",[t._v("serverCacheKey")]),t._v(" to implement component caching, but there are some caveats you should know first: "),e("a",{attrs:{href:"https://ssr.vuejs.org/guide/caching.html#component-level-caching",target:"_blank",rel:"noopener noreferrer"}},[t._v("Component-level Caching"),e("OutboundLink")],1)])])},[],!1,null,null,null);a.default=s.exports}}]);