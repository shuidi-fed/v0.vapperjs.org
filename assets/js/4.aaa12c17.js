(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{227:function(t,a,e){t.exports=e.p+"assets/img/spa-ssr-prerender.701eb249.png"},240:function(t,a,e){t.exports=e.p+"assets/img/builder.b418cf5b.png"},241:function(t,a,e){t.exports=e.p+"assets/img/error-handling.3a08fb6c.png"},279:function(t,a,e){"use strict";e.r(a);var n=e(38),s=Object(n.a)({},function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介","aria-hidden":"true"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("本节内容将介绍 "),n("code",[t._v("Vapper")]),t._v(" 的设计理念，它不是必须要阅读的。")])]),t._v(" "),n("p",[n("code",[t._v("Vapper")]),t._v(" 是一个基于 "),n("code",[t._v("Vue")]),t._v(" 的服务端渲染("),n("code",[t._v("SSR")]),t._v(")框架，它的核心目标是："),n("strong",[t._v("简单")]),t._v("、"),n("strong",[t._v("灵活")]),t._v("、"),n("strong",[t._v("强大")]),t._v("。")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("简单")]),t._v("：尽最大的努力让开发 "),n("code",[t._v("SSR")]),t._v(" 应用与开发 "),n("code",[t._v("SPA")]),t._v(" 应用保持一致的体验，降低学习成本和不同项目间切换的成本。最典型的例子是 "),n("code",[t._v("Vapper")]),t._v(" 提供的"),n("router-link",{attrs:{to:"/zh/data-prefetching.html#数据预取"}},[t._v("数据预取")]),t._v("方案。")],1)]),t._v(" "),n("li",[n("p",[n("strong",[t._v("灵活")]),t._v("：灵活体现在很多方面，例如 "),n("code",[t._v("Vapper")]),t._v(" 只负责必要的 "),n("code",[t._v("webpack")]),t._v(" 配置，这使得它可以配合 "),n("a",{attrs:{href:"https://cli.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue-CLI"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://poi.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Poi"),n("OutboundLink")],1),t._v(" 等优秀的工具一起使用；同时 "),n("code",[t._v("Vapper")]),t._v(" 允许你在路由级别上控制是否开启 "),n("code",[t._v("SSR")]),t._v("、"),n("code",[t._v("SPA")]),t._v(" 或预渲染的能力，这意味着同一个项目中不同的路由可能采用不同的处理方式。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("强大")]),t._v("："),n("code",[t._v("Vapper")]),t._v(" 的核心非常简单，但它的"),n("router-link",{attrs:{to:"/zh/using-plugin.html#简介"}},[t._v("插件")]),t._v("架构，让你拥有“渐进式”的增强能力，通过不同的插件对 "),n("code",[t._v("Vapper")]),t._v(" 进行扩展，几乎能做到任何你期望的事情。实际上，"),n("code",[t._v("Vapper")]),t._v(" 的许多核心功能也是以插件的方式实现的。")],1)])]),t._v(" "),n("h2",{attrs:{id:"只负责必要的-webpack-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#只负责必要的-webpack-配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 只负责必要的 webpack 配置")]),t._v(" "),n("p",[t._v("实际上，"),n("code",[t._v("Vue")]),t._v(" SSR 的原理很简单，我们需要两份 "),n("code",[t._v("webpack")]),t._v(" 配置："),n("code",[t._v("server config")]),t._v(" 和 "),n("code",[t._v("client config")]),t._v("，其中 "),n("code",[t._v("server config")]),t._v(" 用于生成 "),n("code",[t._v("server bundle")]),t._v("，"),n("code",[t._v("client config")]),t._v(" 用于生成发送给浏览器的资源以及 "),n("code",[t._v("clientManifest")]),t._v("。")]),t._v(" "),n("p",[t._v("这些 "),n("code",[t._v("webpack")]),t._v(" 配置，大部分与我们开发 "),n("code",[t._v("SPA")]),t._v(" 应用的 "),n("code",[t._v("webpack")]),t._v(" 配置相同，只需要稍微调整即可用于 "),n("code",[t._v("SSR")]),t._v("，因此 "),n("code",[t._v("Vapper")]),t._v(" 不会选择自己管理 "),n("code",[t._v("webpack")]),t._v(" 配置，而是只负责必要的 "),n("code",[t._v("webpack")]),t._v(" 配置，这样 "),n("code",[t._v("Vapper")]),t._v(" 就可以配合 "),n("a",{attrs:{href:"https://cli.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue-CLI"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://poi.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Poi"),n("OutboundLink")],1),t._v(" 等优秀的工具一起使用。这么做带来的好处是："),n("a",{attrs:{href:"https://cli.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue-CLI"),n("OutboundLink")],1),t._v(" 或 "),n("a",{attrs:{href:"https://poi.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Poi"),n("OutboundLink")],1),t._v(" 所拥有的能力，就是 "),n("code",[t._v("Vapper")]),t._v(" 所拥有的能力。")]),t._v(" "),n("p",[n("code",[t._v("Vapper")]),t._v(" 提供了两个包，分别用于集成 "),n("a",{attrs:{href:"https://cli.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue-CLI"),n("OutboundLink")],1),t._v(" 和 "),n("a",{attrs:{href:"https://poi.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Poi"),n("OutboundLink")],1),t._v("：")]),t._v(" "),n("ul",[n("li",[n("router-link",{attrs:{to:"/zh/configer.html#vapper-configer-vue-cli"}},[t._v("@vapper/configer-vue-cli")])],1),t._v(" "),n("li",[n("router-link",{attrs:{to:"/zh/configer.html#vapper-configer-poi"}},[t._v("@vapper/configer-poi")])],1)]),t._v(" "),n("p",[t._v("如下示意图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:e(240),alt:"builder"}})]),t._v(" "),n("p",[t._v("除了使用 "),n("a",{attrs:{href:"https://cli.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue-CLI"),n("OutboundLink")],1),t._v(" 或 "),n("a",{attrs:{href:"https://poi.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Poi"),n("OutboundLink")],1),t._v(" 作为 "),n("code",[t._v("webpack")]),t._v(" 管理工具之外，你也可以使用自己的 "),n("code",[t._v("webpack")]),t._v(" 配置，"),n("code",[t._v("Vapper")]),t._v(" 的 "),n("code",[t._v("Builder")]),t._v(" 模块只要求你暴露如下 "),n("code",[t._v("getServerConfig")]),t._v(" 和 "),n("code",[t._v("getClientConfig")]),t._v(" 方法：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("MyOwnConfiger")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("getServerConfig")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token operator"}},[t._v("...")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),n("span",{attrs:{class:"token comment"}},[t._v("// 返回 server 配置")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("getClientConfig")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token operator"}},[t._v("...")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),n("span",{attrs:{class:"token comment"}},[t._v("// 返回 client 配置")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("详情请查看："),n("router-link",{attrs:{to:"/zh/configer.html#编写-configer"}},[t._v("编写 Configer")])],1),t._v(" "),n("h2",{attrs:{id:"路由级别的控制能力"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由级别的控制能力","aria-hidden":"true"}},[t._v("#")]),t._v(" 路由级别的控制能力")]),t._v(" "),n("p",[n("code",[t._v("Vapper")]),t._v(" 的另一个设计目标是“尽可能的灵活”，考虑如下场景：")]),t._v(" "),n("p",[n("img",{attrs:{src:e(227),alt:"spa-ssr-prerender"}})]),t._v(" "),n("p",[t._v("我们的需求是，当用户访问 "),n("code",[t._v("/home")]),t._v(" 时，我们希望执行服务端渲染("),n("code",[t._v("SSR")]),t._v(")；当用户访问 "),n("code",[t._v("/foo")]),t._v(" 时，我们希望将 "),n("code",[t._v("SPA")]),t._v(" 页面发送给用户；当用户访问 "),n("code",[t._v("/bar")]),t._v(" 时，我们希望将预渲染的内容发送给用户。你可能已经注意到了，这需要我们有路由级别的控制能力，"),n("code",[t._v("Vapper")]),t._v(" 拥有这样的能力，如下路由规则所示：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 用于创建路由的工厂函数")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("VueRouter")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mode"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'history'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    routes"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        path"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'/home'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        component"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./components/Home.vue'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 开启 ssr")]),t._v("\n        meta"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ssr"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        path"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'/foo'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        component"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./components/Foo.vue'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 关闭 ssr，将发送 SPA 页面给用户")]),t._v("\n        meta"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ssr"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("我们可以使用 "),n("code",[t._v("@vapper/plugin-prerender")]),t._v(" 插件支持预渲染，并且可以指定需要预渲染的路由，这样 "),n("code",[t._v("Vapper")]),t._v(" 将会在构建时把开启了 "),n("code",[t._v("SSR")]),t._v(" 并且被指定为预渲染的路由渲染成 "),n("code",[t._v("html")]),t._v(" 文件，当用户请求到来时，"),n("code",[t._v("Vapper")]),t._v(" 会把这个 "),n("code",[t._v("html")]),t._v(" 作为静态资源发送给用户。")]),t._v(" "),n("h2",{attrs:{id:"错误处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#错误处理","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误处理")]),t._v(" "),n("p",[t._v("当错误发生时，我们有两种选择：")]),t._v(" "),n("p",[n("img",{attrs:{src:e(241),alt:"error-handling"}})]),t._v(" "),n("ul",[n("li",[t._v("1、展示错误页面给用户")]),t._v(" "),n("li",[t._v("2、不展示错误页面，而是回退到 "),n("code",[t._v("SPA")]),t._v(" 模式")])]),t._v(" "),n("p",[n("code",[t._v("Vapper")]),t._v(" 允许你灵活的控制错误处理的方式，当错误发生时，你可以展示错误页面给用户，你也可以回退到 "),n("code",[t._v("SPA")]),t._v(" 模式，这样当有非致命的错误发生时，用户依然可以使用我们的应用。")]),t._v(" "),n("p",[t._v("有一点是你需要知道的："),n("strong",[t._v("回退 "),n("code",[t._v("SPA")]),t._v(" 模式的实现非常简单，因为当一个 "),n("code",[t._v("Vapper")]),t._v(" 项目中没有任何路由开启 "),n("code",[t._v("SSR")]),t._v("，那么它就是一个 "),n("code",[t._v("SPA")]),t._v(" 应用")]),t._v("，构建产生的资源与 "),n("code",[t._v("SPA")]),t._v(" 应用几乎相同。")]),t._v(" "),n("p",[t._v("阅读 "),n("router-link",{attrs:{to:"/zh/error-handling.html#自定义错误页面"}},[t._v("自定义错误页面")]),t._v(" 和 "),n("router-link",{attrs:{to:"/zh/error-handling.html#回退-spa-模式"}},[t._v("Fallback SPA")]),t._v(" 了解详细内容。")],1),t._v(" "),n("h2",{attrs:{id:"数据预取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据预取","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据预取")]),t._v(" "),n("p",[n("code",[t._v("Vapper")]),t._v(" 提供更直观更强大的数据预取方式：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th"),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("能否访问 "),n("code",[t._v("this")])]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("能否用于任意组件")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("能否既用于服务端又用于客户端")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("能否预取组件级别的数据")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("nuxt/ream")]),t._v(" 的 "),n("code",[t._v("asyncData")])]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❌")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❌")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("Vue")]),t._v(" 原生的 "),n("code",[t._v("serverPrefetch")])]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❌")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❌")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("vapper")])]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")])])])]),t._v(" "),n("p",[t._v("详细内容请阅读："),n("router-link",{attrs:{to:"/zh/data-prefetching.html#createfetcher-函数"}},[t._v("数据预取")])],1),t._v(" "),n("h2",{attrs:{id:"插件架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件架构","aria-hidden":"true"}},[t._v("#")]),t._v(" 插件架构")]),t._v(" "),n("p",[n("code",[t._v("Vapper")]),t._v(" 的插件架构非常灵活，它借鉴了 "),n("a",{attrs:{href:"https://cli.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue-CLI"),n("OutboundLink")],1),t._v(" 的插件架构，你可以扩展 "),n("code",[t._v("CLI")]),t._v(" 命令，可以添加服务器中间件，还可以通过钩子参与到 "),n("code",[t._v("Vapper")]),t._v(" 的整个生命周期。")]),t._v(" "),n("p",[t._v("实际上，"),n("code",[t._v("Vapper")]),t._v(" 的很多核心功能都是采用自身的插件机制编写，例如 "),n("code",[t._v("Fallback SPA")]),t._v("、"),n("code",[t._v("micro-caching")]),t._v(" 等，除此之外 "),n("code",[t._v("Vapper")]),t._v(" 通过插件能够渐进式的支持许多你期望的功能，官方提供的插件如下：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("@vapper/plugin-fs-routes")])]),t._v(" "),n("li",[n("router-link",{attrs:{to:"/zh/using-plugin.html#vapper-plugin-cookie"}},[t._v("@vapper/plugin-cookie")])],1)]),t._v(" "),n("p",[t._v("可以查看 "),n("router-link",{attrs:{to:"/zh/write-plugin.html"}},[t._v("插件开发")]),t._v(" 以了解如何编写一个插件。")],1)])},[],!1,null,null,null);a.default=s.exports}}]);